// ng-couchbase-lite - v0.0.1 (2016-02-05)
// http://www.couchbase.com
angular.module("ngCouchbaseLite",[]).factory("$couchbase",["$q","$http","$rootScope",function(a,b,c){this.databaseUrl=null,this.databaseName=null;var d=function(a,b){this.databaseUrl=a,this.databaseName=b};return d.prototype={createDatabase:function(){return this.makeRequest("PUT",this.databaseUrl+this.databaseName)},getDatabase:function(){return this.makeRequest("GET",this.databaseUrl+this.databaseName)},createDesignDocument:function(a,b){var c={views:b};return this.makeRequest("PUT",this.databaseUrl+this.databaseName+"/"+a,{},c)},getDesignDocument:function(a){return this.makeRequest("GET",this.databaseUrl+this.databaseName+"/"+a)},queryView:function(a,b,c){return this.makeRequest("GET",this.databaseUrl+this.databaseName+"/"+a+"/_view/"+b,c)},createDocument:function(a){return this.makeRequest("POST",this.databaseUrl+this.databaseName,{},a)},updateDocument:function(a,b,c){return this.makeRequest("PUT",this.databaseUrl+this.databaseName+"/"+a,{rev:b},c)},deleteDocument:function(a,b){return this.makeRequest("DELETE",this.databaseUrl+this.databaseName+"/"+a,{rev:b})},getAllDocuments:function(){return this.makeRequest("GET",this.databaseUrl+this.databaseName+"/_all_docs")},getDocument:function(a){return this.makeRequest("GET",this.databaseUrl+this.databaseName+"/"+a)},replicate:function(a,b,c){return this.makeRequest("POST",this.databaseUrl+"_replicate",{},{source:a,target:b,continuous:c})},listen:function(){var a=function(d,e,f){b({method:"GET",url:d+e+"/_changes",params:{feed:"longpoll",since:f},withCredentials:!0}).then(function(b){c.$broadcast("couchbase:change",b.data),setTimeout(function(){a(d,e,b.data.last_seq)},10)},function(a){console.log("POLLING ERROR -> "+JSON.stringify(a))})};a(this.databaseUrl,this.databaseName,0)},makeRequest:function(c,d,e,f){var g=a.defer(),h={method:c,url:d,withCredentials:!0};return e&&(h.params=e),f&&(h.data=f),b(h).success(function(a){g.resolve(a)}).error(function(a){g.reject(a)}),g.promise}},d}]);